<!DOCTYPE html>
<html lang="en">
<head>

    <script src="/utils_metrics/fetch_agent_data_for_initial_load.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Performance Dashboard</title>
    <!-- Load Chart.js first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Load zoom plugin - this might not work but charts will still display -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <!-- Load Hammer.js for touch gestures -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <link rel="stylesheet" href="/main.css">

    <script src="/utils_metrics/chart-controls.js"></script>
    <script src="/utils_metrics/chart-creation.js"></script>
    <script src="/utils_metrics/dashboard-init.js"></script>
    <script src="/utils_metrics/data-filtering.js"></script>
    <script src="/utils_metrics/data-population.js"></script>
    <script src="/utils_metrics/global-state.js"></script>
    <script src="/utils_metrics/heatmap-filtering.js"></script>
    <script src="/utils_metrics/heatmap-functions.js"></script>
    <script src="/utils_metrics/heatmap-generation.js"></script>
    <script src="/utils_metrics/time-period-filtering.js"></script>
    <script src="/utils_metrics/time-utilities.js"></script>


    <script src="/utils_metrics/refresh_request_handlingLogs.js"></script>
    <script src="/utils_metrics/refresh_cumulative_token_usage.js"></script>
    <script src="/utils_metrics/refresh_customer_satisfaction_trend.js"></script>
    <script src="/utils_metrics/refresh_rating_distribution.js"></script>
    <script src="/utils_metrics/refresh_token_usage_per_request.js"></script>
    <script src="/utils_metrics/refresh_activity_heatmap.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Agent Performance Dashboard</h1>
            <p>Comprehensive analytics and performance monitoring for customer support agent</p>
        </div>

        <!-- Agent Basic Info -->
        <div class="agent-info-section">
            <div class="agent-profile-card">
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="agent-avatar">
                        <div class="avatar-circle">
                            <span id="agentInitials"></span>
                        </div>
                    </div>
                    <div class="agent-basic-info">
                        <h2 id="agentName"></h2>
                        <div class="agent-id" id="agentId"></div>
                    </div>
                </div>
                
                <!-- Professional Information Grid -->
                <div class="professional-info">
                    <!-- Agent Information -->
                    <div class="info-section">
                        <h3>Agent Information</h3>
                        <div class="info-item">
                            <div class="info-icon">üë§</div>
                            <div class="info-content">
                                <div class="info-label">Agent Name</div>
                                <div class="info-value" id="agentNameDisplay"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üÜî</div>
                            <div class="info-content">
                                <div class="info-label">Agent ID</div>
                                <div class="info-value" id="agentIdDisplay"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üìÖ</div>
                            <div class="info-content">
                                <div class="info-label">Established</div>
                                <div class="info-value" id="establishmentDate"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üõ†Ô∏è</div>
                            <div class="info-content">
                                <div class="info-label">Services Provided</div>
                                <div class="info-value" id="servicesCount">Loading...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Company Information -->
                    <div class="info-section">
                        <h3>Company Information</h3>
                        <div class="info-item">
                            <div class="info-icon">üè¢</div>
                            <div class="info-content">
                                <div class="info-label">Company Name</div>
                                <div class="info-value company-name" id="companyName"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üëî</div>
                            <div class="info-content">
                                <div class="info-label">Company Owner</div>
                                <div class="info-value" id="companyOwnerName"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üìß</div>
                            <div class="info-content">
                                <div class="info-label">Company Email</div>
                                <div class="info-value email" id="companyEmail"></div>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon">üìû</div>
                            <div class="info-content">
                                <div class="info-label">Service Number</div>
                                <div class="info-value phone" id="companyHumanServiceNumber"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="totalRequests"></div>
                <div class="metric-label">Total Requests Handled</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="totalTokens"></div>
                <div class="metric-label">Total Tokens Used</div>
            </div>
            <div class="metric-card" style="border: 2px solid var(--success); background: rgba(34, 197, 94, 0.1);">
                <div class="metric-value" style="color: var(--success); font-size: 3rem;" id="satisfactionRate"></div>
                <div class="metric-label" style="color: var(--success); font-weight: 600;">Satisfaction Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="availableTokens"></div>
                <div class="metric-label">Available Tokens</div>
            </div>
        </div>

        <!-- Services Section -->
        <div class="services-section">
            <h2>Available Services</h2>

            <div class="services-grid" id="servicesGrid">
                <!-- Populated by JS -->
            </div>

            <div class="services-loadmore-container">
                <div class="services-navigation">
                    <button id="servicesBackBtn" class="services-back-btn" style="display:none;">
                        ‚Üê Back
                    </button>

                    <button id="servicesLoadMoreBtn" class="services-loadmore-btn">
                        Load More Services
                    </button>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <!-- Request Timeline Chart -->
            <div class="chart-container-wrapper">
                <div class="chart-header">
                    <h2 class="chart-title">Request Handling Timeline (Hourly Distribution)</h2>
                    <div class="chart-controls">
                        <div class="time-period-buttons">
                            <button class="time-period-btn active" data-period="days" data-chart="requestChart">Day</button>
                            <button class="time-period-btn" data-period="weeks" data-chart="requestChart">Week</button>
                            <button class="time-period-btn" data-period="months" data-chart="requestChart">Month</button>
                            <button class="time-period-btn" data-period="years" data-chart="requestChart">Year</button>
                            <button class="time-period-btn" data-period="lifetime" data-chart="requestChart">Lifetime</button>
                        </div>
                        <button class="control-btn" onclick="resetZoom('requestChart')">Reset Zoom</button>
                        <button class="control-btn secondary" onclick="exportChart('requestChart')">Export</button>
                        <button class="control-btn refresh-btn" id="refreshLogsBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="zoom-info">Interactive Timeline - Scroll to zoom, drag to pan</div>
                    <canvas id="requestChart"></canvas>
                </div>
            </div>

            <!-- Token Usage Chart -->
            <div class="chart-container-wrapper">
                <div class="chart-header">
                    <h2 class="chart-title">Cumulative Token Usage</h2>
                    <div class="chart-controls">
                        <div class="time-period-buttons">
                            <button class="time-period-btn active" data-period="days" data-chart="tokenChart">Day</button>
                            <button class="time-period-btn" data-period="weeks" data-chart="tokenChart">Week</button>
                            <button class="time-period-btn" data-period="months" data-chart="tokenChart">Month</button>
                            <button class="time-period-btn" data-period="years" data-chart="tokenChart">Year</button>
                            <button class="time-period-btn" data-period="lifetime" data-chart="tokenChart">Lifetime</button>
                        </div>
                        <button class="control-btn" onclick="resetZoom('tokenChart')">Reset Zoom</button>
                        <button class="control-btn secondary" onclick="exportChart('tokenChart')">Export</button>
                        <button class="control-btn refresh-btn" id="tokenUsageRefreshBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="zoom-info">Cumulative Usage - Interactive</div>
                    <canvas id="tokenChart"></canvas>
                </div>
            </div>

            <!-- Dual Charts Grid -->
            <div class="dual-chart-grid">
                <!-- Satisfaction Rate Chart -->
                <div class="chart-container-wrapper">
                    <div class="chart-header">
                        <h2 class="chart-title">Customer Satisfaction Trend</h2>
                        <div class="chart-controls">
                            <div class="time-period-buttons">
                                <button class="time-period-btn active" data-period="days" data-chart="satisfactionChart">Day</button>
                                <button class="time-period-btn" data-period="weeks" data-chart="satisfactionChart">Week</button>
                                <button class="time-period-btn" data-period="months" data-chart="satisfactionChart">Month</button>
                                <button class="time-period-btn" data-period="years" data-chart="satisfactionChart">Year</button>
                                <button class="time-period-btn" data-period="lifetime" data-chart="satisfactionChart">Lifetime</button>
                            </div>
                            <button class="control-btn" onclick="resetZoom('satisfactionChart')">Reset</button>
                            <button class="control-btn refresh-btn" id="refreshSatisfactionRateChartBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="satisfactionChart"></canvas>
                    </div>
                </div>

                <!-- Rating Distribution -->
                <div class="chart-container-wrapper">
                    <div class="chart-header">
                        <h2 class="chart-title">Rating Distribution</h2>
                        <div class="chart-controls">
                            <div class="time-period-buttons">
                                <button class="time-period-btn active" data-period="days" data-chart="ratingChart">Day</button>
                                <button class="time-period-btn" data-period="weeks" data-chart="ratingChart">Week</button>
                                <button class="time-period-btn" data-period="months" data-chart="ratingChart">Month</button>
                                <button class="time-period-btn" data-period="years" data-chart="ratingChart">Year</button>
                                <button class="time-period-btn" data-period="lifetime" data-chart="ratingChart">Lifetime</button>
                            </div>
                            <button class="control-btn" onclick="resetZoom('ratingChart')">Reset</button>
                            <button class="control-btn refresh-btn" onclick="refreshChart('ratingChart')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="ratingChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Token Usage by Request Chart -->
            <div class="chart-container-wrapper">
                <div class="chart-header">
                    <h2 class="chart-title">Token Usage per Request</h2>
                    <div class="chart-controls">
                        <div class="time-period-buttons">
                            <button class="time-period-btn active" data-period="days" data-chart="tokenPerRequestChart">Day</button>
                            <button class="time-period-btn" data-period="weeks" data-chart="tokenPerRequestChart">Week</button>
                            <button class="time-period-btn" data-period="months" data-chart="tokenPerRequestChart">Month</button>
                            <button class="time-period-btn" data-period="years" data-chart="tokenPerRequestChart">Year</button>
                            <button class="time-period-btn" data-period="lifetime" data-chart="tokenPerRequestChart">Lifetime</button>
                        </div>
                        <button class="control-btn" onclick="resetZoom('tokenPerRequestChart')">Reset</button>
                        <button class="control-btn secondary" onclick="exportChart('tokenPerRequestChart')">Export</button>
                        <button class="control-btn refresh-btn" id="refreshTokenUsagePerRequestBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="tokenPerRequestChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Activity Heatmap -->
        <div class="charts-section">
            <div class="chart-container-wrapper">
                <div class="chart-header">
                    <h2 class="chart-title" id="heatmapTitle">Activity Heatmap - Recent 24 Hours</h2>
                    <div class="chart-controls">
                        <div class="time-period-buttons">
                            <button class="time-period-btn active" data-period="days" data-chart="activityHeatmap">Day</button>
                            <button class="time-period-btn" data-period="weeks" data-chart="activityHeatmap">Week</button>
                            <button class="time-period-btn" data-period="months" data-chart="activityHeatmap">Month</button>
                            <button class="time-period-btn" data-period="years" data-chart="activityHeatmap">Year</button>
                            <button class="time-period-btn" data-period="lifetime" data-chart="activityHeatmap">Lifetime</button>
                        </div>
                        <button class="control-btn" onclick="resetHeatmap()">Reset View</button>
                        <button class="control-btn refresh-btn" id="refreshActivityHeatmapBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="m20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="heatmap-container">
                    <div class="heatmap-grid" id="activityHeatmap"></div>
                    <div class="heatmap-legend">
                        <span>Less Active</span>
                        <div class="legend-bar">
                            <div class="legend-step" data-level="0"></div>
                            <div class="legend-step" data-level="1"></div>
                            <div class="legend-step" data-level="2"></div>
                            <div class="legend-step" data-level="3"></div>
                            <div class="legend-step" data-level="4"></div>
                        </div>
                        <span>More Active</span>
                    </div>
                    <div class="heatmap-info" id="heatmapInfo">Showing hourly activity distribution</div>
                </div>
            </div>
        </div>
        
        <!-- Reviews Section -->
        <div class="reviews-section">
            <h2>Customer Reviews</h2>
            <div class="reviews-grid" id="reviewsGrid">
                <!-- Reviews will be populated by JavaScript -->
            </div>
            <div class="review-load-container">
                <button class="review-back-btn" id="reviewsBackBtn" style="display:none;">
                    ‚Üê Back
                </button>

                <button class="review-load-btn" id="reviewsLoadMoreBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m6 9 6 6 6-6"></path>
                    </svg>
                    Load More Reviews
                </button>
            </div>
        </div>

        <!-- Modification History Section -->
        <div class="history-section">
            <h2>Modification History</h2>
            <div class="history-timeline" id="historyTimeline">
                <!-- History populated by JS -->
            </div>

            <div class="load-more-container">
                <button class="load-more-btn" id="backHistoryBtn" style="display:none;">
                    ‚Üê Back
                </button>
                <button class="load-more-btn" id="loadMoreHistoryBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m6 9 6 6 6-6"></path>
                    </svg>
                    Load More History
                </button>
            </div>
        </div>
    </div>
</body>
</html>